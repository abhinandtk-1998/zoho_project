{% extends 'base.html' %}
{% block content %}
{% load static %}


<style>
    table tr td:hover {
    cursor: pointer;
  }

  a{
    color: white;
  }
  a:hover{
    color:white;
  }
</style>

<body>
  
    <div class="body-wrapper">
      <div class="container-fluid">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
            <li class="breadcrumb-item" aria-current="page">Holiday</li>
          </ol>
        </nav>
        <div style="overflow-x:auto;"> 
          <h1 class="text-center text-white">ALL HOLIDAYS</h1>
          <div class="table-responsive">
            <input type="text" id="searchInput" placeholder="Search...">
            <label for="sortOption">Sort by:</label>
            <select id="sortOption">
              <option value="all">All</option>
              <option value="month">Month</option>
              <option value="year">Year</option>
            </select>
            <button onclick="exportToExcel()" class="btn btn-outline-secondary mb-2 text-grey"><i class="fa fa-arrow-up"></i>Export</button>
            <a href="{% url 'company_holiday_import' %}" class="btn btn-outline-secondary mb-2 text-grey"><i class="fa fa-arrow-down"></i> Import </a>
            <a href="{% url 'company_holiday_new' %}" class="btn btn-outline-secondary mb-2 text-grey"><i class="fa fa-plus text-yellow" ></i>New</a>
            <table class="table mt-lg-5 mt-2 rounded" style="background-color: rgb(0, 0, 0);color: white;" id="myTable">
              <thead>
                <tr class="border-bottom border-dark">
                  <th scope="col" ><b>Sl no.</b></th>
                  <th scope="col" ><b>Month</b></th>
                  <th scope="col" ><b>Year</b></th>
                  <th scope="col" ><b>Holidays</b></th>
                  <th scope="col" ><b>Working days</b></th>
                </tr>
              </thead>
              <tbody>
                {% for key, row in holiday_table.items %}
                
                <tr class="border-bottom border-dark">
                  <a href="{% url 'company_holiday_overview' %}?month={{ row.1 }}&year={{ row.2}}">
                  <td><a href="{% url 'company_holiday_overview' %}?month={{ row.1 }}&year={{ row.2}}">{{ row.0 }}</a></td>
                  <td><a href="{% url 'company_holiday_overview' %}?month={{ row.1 }}&year={{ row.2}}">{{ row.1 }}</a></td>
                  <td><a href="{% url 'company_holiday_overview' %}?month={{ row.1 }}&year={{ row.2}}">{{ row.2 }}</a></td>
                  <td><a href="{% url 'company_holiday_overview' %}?month={{ row.1 }}&year={{ row.2}}">{{ row.3 }}</a></td>
                  <td><a href="{% url 'company_holiday_overview' %}?month={{ row.1 }}&year={{ row.2}}">{{ row.4 }}</a></td>
                  </a>
                </tr>
                {% endfor %}
              </tbody>
            </table> 

    
          </div> 
        </div>
  
      </div>
    </div>





    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let searchInput = document.getElementById('searchInput');
        let sortOption = document.getElementById('sortOption');
        let tableBody = document.querySelector('tbody');
        let rows = tableBody.getElementsByTagName('tr');

        searchInput.addEventListener('keyup', filterRows);
        sortOption.addEventListener('change', sortRows);

        function filterRows() {
          let filter = searchInput.value.toUpperCase();

          for (let i = 0; i < rows.length; i++) {
            let row = rows[i];
            let cells = row.getElementsByTagName('td');
            let found = false;

            for (let j = 0; j < cells.length; j++) {
              let cell = cells[j];
              if (cell) {
                let textValue = cell.textContent || cell.innerText;
                if (textValue.toUpperCase().indexOf(filter) > -1) {
                  found = true;
                  break;
                }
              }
            }

            if (found) {
              row.style.display = '';
            } else {
              row.style.display = 'none';
            }
          }
        }

        function sortRows() {
          let sortBy = sortOption.value;
          let rowsArray = Array.from(rows);

          rowsArray.sort(function(a, b) {
            let aValue = a.cells[sortBy === 'all' ? 0 : sortBy === 'month' ? 1 : 2].innerText;
            let bValue = b.cells[sortBy === 'all' ? 0 : sortBy === 'month' ? 1 : 2].innerText;

            if (sortBy === 'month') {
              aValue = getMonthIndex(aValue);
              bValue = getMonthIndex(bValue);
            } else if (sortBy === 'year') {
              aValue = parseInt(aValue);
              bValue = parseInt(bValue);
            }

            return aValue - bValue;
          });

          for (let i = 0; i < rowsArray.length; i++) {
            tableBody.appendChild(rowsArray[i]);
          }
        }

        function getMonthIndex(monthName) {
          const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
          return months.indexOf(monthName);
        }
      });


      function exportToExcel() {
        const table = document.getElementById("myTable");
        const rows = table.querySelectorAll("tr");
        let csvContent = "data:text/csv;charset=utf-8,";

        // Include table headers
        const headers = [];
        table.querySelectorAll("th").forEach(function(header) {
          headers.push(header.innerText);
        });
        csvContent += headers.join(",") + "\n";

        // Include table data
        rows.forEach(function(row) {
          const rowData = [];
          row.querySelectorAll("td").forEach(function(cell) {
            rowData.push(cell.innerText);
          });
          csvContent += rowData.join(",") + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "table_data.csv");
        document.body.appendChild(link);
        link.click();
      }
    </script>
    
  </body>




{% endblock %}